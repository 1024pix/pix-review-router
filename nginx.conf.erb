# This regex matches host names like:
#    orga-pr123.review.pix.fr
# and sets variables:
#    $app = "orga"
#    $pr = "pr123"
server_name ~^(?<app>[^-]+)-(?<pr>[^.]+)(.+)$;

location / {
  proxy_pass https://scalingo.io/$app$uri;
  proxy_set_header Host pix-front-integration-$pr.scalingo.io;
}

location /api/ {
  proxy_pass https://scalingo.io;
  proxy_set_header Host pix-api-integration-$pr.scalingo.io;
}
